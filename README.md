# Submission 126: STONE: A Spatio-temporal OOD Learning Framework Kills Both Spatial and Temporal Shifts

## Data preparation about SD and GBA datasets
The SD and GBA datasets are contained in the CA dataset, followed by [LargeST](https://github.com/liuxu77/LargeST/blob/main). There are a total of 7 files in this dataset. Among them, 5 files in .h5 format contain the traffic flow raw data from 2017 to 2021, 1 file in .csv format provides the metadata for all sensors, and 1 file in .npy format represents the adjacency matrix constructed based on road network distances. You can download all data from the provided [link](https://www.kaggle.com/datasets/liuxu77/largest) and place the downloaded archive.zip file in the `data/ca` folder and unzip the file.

In our experiments, we used datasets SD and GBA, which are generated by jupyter notebooks `process_sd_his.ipynb` and `process_gba_his.ipynb` in the folder `data/sd` and `data/gba` respectively, where process and generate a cleaned version of the flow data of SD and GBA.  
3. Please go to the `data` folder, and use the command below to generate the flow data for model training in our manuscript to generate traffic flow data for training. For ex
```
python generate_data_for_training.py --dataset ca --years 2019
```
The processed data are stored in `data/ca/2019`. We also support the utilization of data from multiple years. For example, changing the years argument to 2018_2019 to generate two years of data.
 
### 1.4 Generate Other Sub-Datasets
We describe the generation of the GLA dataset as an example. Please first go through all the cells in the provided jupyter notebook `generate_gla_dataset.ipynb` in the folder `data/gla`. Then, use the command below to generate traffic flow data for model training.
```
python generate_data_for_training.py --dataset gla --years 2019
```



## 2. Environmental Requirments

## 3. Data Processing

## 4. Model Running
To run STONE, for example, you may execute this command in the terminal:
```
bash experiments/stone/run.sh
```
or directly execute the Python file in the terminal:
```
python experiments/stone/main.py --device cuda:0 --dataset SD --years 2019 --model_name stone --seed 0 --bs 64
```
